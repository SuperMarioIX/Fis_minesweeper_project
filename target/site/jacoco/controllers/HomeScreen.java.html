<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HomeScreen.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">FIS_Minesweeper_Game_final</a> &gt; <a href="index.source.html" class="el_package">controllers</a> &gt; <span class="el_source">HomeScreen.java</span></div><h1>HomeScreen.java</h1><pre class="source lang-java linenums">package controllers;

import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Node;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.TextField;
import javafx.scene.text.Text;
import javafx.stage.Stage;
import org.json.simple.JSONArray;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;

import javax.management.relation.Role;
import java.io.FileReader;
import java.io.IOException;
import java.net.URL;
import java.util.Objects;
import java.util.ResourceBundle;
import java.util.StringTokenizer;

<span class="pc bpc" id="L27" title="1 of 2 branches missed.">public class HomeScreen implements Initializable {</span>

    public String vip;

    @FXML
    private Text text;

    @FXML
    private TextField usernameField;
    @FXML
    private TextField passwordField;

    @FXML
    public Button Login;

    @FXML
    void initialize() {
<span class="nc" id="L44">        Login.setOnAction(event -&gt; {</span>
            try {
<span class="nc" id="L46">                handleLoginAction();</span>
<span class="nc" id="L47">            } catch (ParseException | IOException e) {</span>
<span class="nc" id="L48">                e.printStackTrace();</span>
<span class="nc" id="L49">            }</span>
<span class="nc" id="L50">        });</span>
<span class="nc" id="L51">    }</span>

    @FXML
    public void Login(ActionEvent event) throws IOException {
<span class="nc" id="L55">        String un = usernameField.getText();</span>
<span class="nc" id="L56">        String pw = passwordField.getText();</span>
<span class="nc" id="L57">        JSONArray userList = readFile(&quot;src/main/java/sources/users.json&quot;);</span>
<span class="nc bnc" id="L58" title="All 4 branches missed.">        assert userList != null;</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">        for(Object user : userList){</span>
<span class="nc" id="L60">            JSONObject jsonObject = (JSONObject) user;</span>
<span class="nc" id="L61">            JSONObject credentials = (JSONObject) jsonObject.get(&quot;Credentials&quot;);</span>
<span class="nc" id="L62">            String username = (String) credentials.get(&quot;Username&quot;);</span>
<span class="nc" id="L63">            String password = (String) credentials.get(&quot;Password&quot;);</span>
<span class="nc bnc" id="L64" title="All 4 branches missed.">            if (username.equals(un) &amp;&amp; password.equals(pw)){</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">                if(((String) jsonObject.get(&quot;Role&quot;)).equals(&quot;admin&quot;)){</span>
<span class="nc" id="L66">                    Parent viewParent = FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource(&quot;fxmlFiles/AdminHomeScreen.fxml&quot;)));</span>
<span class="nc" id="L67">                    Scene viewScene = new Scene(viewParent);</span>
<span class="nc" id="L68">                    Stage window = (Stage) ((Node) event.getSource()).getScene().getWindow();</span>
<span class="nc" id="L69">                    window.setScene(viewScene);</span>
<span class="nc" id="L70">                    window.show();</span>
<span class="nc" id="L71">                } else {</span>
<span class="nc" id="L72">                    Parent viewParent = FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource(&quot;fxmlFiles/UserHomeScreen.fxml&quot;)));</span>
<span class="nc" id="L73">                    Scene viewScene = new Scene(viewParent);</span>
<span class="nc" id="L74">                    Stage window = (Stage) ((Node) event.getSource()).getScene().getWindow();</span>
<span class="nc" id="L75">                    window.setScene(viewScene);</span>
<span class="nc" id="L76">                    window.show();</span>
                }
            }
<span class="nc" id="L79">        }</span>

<span class="nc" id="L81">    }</span>

    @FXML
    public boolean handleLoginAction() throws ParseException, IOException {
<span class="fc" id="L85">        Login.setOnAction(event -&gt; {</span>
<span class="nc" id="L86">            String un = usernameField.getText();</span>
<span class="nc" id="L87">            String pw = passwordField.getText();</span>
<span class="nc" id="L88">            String client = un.substring(un.length() - 3);</span>
<span class="nc" id="L89">            vip = un.substring(un.length() - 4);</span>
<span class="nc" id="L90">            JSONArray userList = readFile(&quot;src/main/java/sources/users.json&quot;);</span>
<span class="nc bnc" id="L91" title="All 4 branches missed.">            assert userList != null;</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">            for (Object o : userList) {</span>
<span class="nc" id="L93">                JSONObject jsonObject = (JSONObject) o;</span>
<span class="nc" id="L94">                JSONObject credentials = (JSONObject) jsonObject.get(&quot;Credentials&quot;);</span>
<span class="nc" id="L95">                String username = (String) credentials.get(&quot;Username&quot;);</span>
<span class="nc" id="L96">                String password = (String) credentials.get(&quot;Password&quot;);</span>

<span class="nc bnc" id="L98" title="All 4 branches missed.">                if (username.equals(un) &amp;&amp; password.equals(pw)) {</span>
<span class="nc" id="L99">                    Stage appStage = (Stage) Login.getScene().getWindow();</span>
                    Parent root;
<span class="nc bnc" id="L101" title="All 2 branches missed.">                    if (client.equals(&quot;clt&quot;))</span>
                        try {
<span class="nc" id="L103">                            root = FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource(&quot;fxmlFiles/UserHomeScreen.fxml&quot;)));</span>
<span class="nc" id="L104">                            Scene scene = new Scene(root);</span>
<span class="nc" id="L105">                            appStage.setScene(scene);</span>
<span class="nc" id="L106">                            appStage.show();</span>
<span class="nc" id="L107">                        } catch (IOException ex) {</span>
<span class="nc" id="L108">                            ex.printStackTrace();</span>
<span class="nc" id="L109">                        }</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">                    else if (client.equals(&quot;adm&quot;))</span>
                        try {
<span class="nc" id="L112">                            root = FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource(&quot;fxmlFiles/AdminHomeScreen.fxml&quot;)));</span>
<span class="nc" id="L113">                            Scene scene = new Scene(root);</span>
<span class="nc" id="L114">                            appStage.setScene(scene);</span>
<span class="nc" id="L115">                            appStage.show();</span>
<span class="nc" id="L116">                        } catch (IOException ex) {</span>
<span class="nc" id="L117">                            ex.printStackTrace();</span>
<span class="nc" id="L118">                        }</span>
<span class="nc" id="L119">                } else text.setText(&quot;Log in failed, wrong credentials&quot;);</span>
<span class="nc" id="L120">            }</span>
<span class="nc" id="L121">        });</span>
<span class="fc" id="L122">        return true;</span>
    }

    public JSONArray readFile(String sourceFilePath) {
<span class="fc" id="L126">        JSONParser parser = new JSONParser();</span>
<span class="fc" id="L127">        Object obj = null;</span>
        try {
<span class="fc" id="L129">            obj = parser.parse(new FileReader(sourceFilePath));</span>
<span class="nc" id="L130">        } catch (IOException | ParseException exception) {</span>
<span class="nc" id="L131">            exception.printStackTrace();</span>
<span class="fc" id="L132">        }</span>
<span class="fc" id="L133">        JSONArray userList = (JSONArray) obj;</span>
<span class="fc" id="L134">        return userList;</span>
    }
    @FXML
    public void Guest(ActionEvent event) throws IOException {
<span class="nc" id="L138">        Parent viewParent = FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource(&quot;fxmlFiles/PlayGuest.fxml&quot;)));</span>
<span class="nc" id="L139">        Scene viewScene = new Scene(viewParent);</span>
<span class="nc" id="L140">        Stage window = (Stage) ((Node) event.getSource()).getScene().getWindow();</span>
<span class="nc" id="L141">        window.setScene(viewScene);</span>
<span class="nc" id="L142">        window.show();</span>
<span class="nc" id="L143">    }</span>
    @FXML
    public void Leaderboard(ActionEvent event) throws IOException {
<span class="nc" id="L146">        Parent viewParent = FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource(&quot;fxmlFiles/Leaderboard.fxml&quot;)));</span>
<span class="nc" id="L147">        Scene viewScene = new Scene(viewParent);</span>
<span class="nc" id="L148">        Stage window = (Stage) ((Node) event.getSource()).getScene().getWindow();</span>
<span class="nc" id="L149">        window.setScene(viewScene);</span>
<span class="nc" id="L150">        window.show();</span>
<span class="nc" id="L151">    }</span>

    @Override
    public void initialize(URL location, ResourceBundle resources) {

<span class="nc" id="L156">    }</span>

    public void Signin(ActionEvent actionEvent) {
<span class="nc" id="L159">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>